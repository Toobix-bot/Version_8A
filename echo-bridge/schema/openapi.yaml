openapi: 3.0.3
info:
  title: ECHO-BRIDGE API
  version: 0.1.0
servers:
  - url: http://127.0.0.1:3333
paths:
  /health:
    get:
      summary: Health check
      responses:
        '200':
          description: OK
  /ingest/text:
    post:
      summary: Ingest plain texts
      security:
        - bridgeKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                source: { type: string }
                title: { type: string }
                texts: { type: array, items: { type: string } }
                meta: { type: object }
              required: [source, texts]
      responses:
        '200': { description: OK }
        '401': { description: Missing or invalid key }
  /search:
    get:
      summary: Search in memory
      parameters:
        - in: query
          name: q
          required: true
          schema: { type: string }
        - in: query
          name: k
          required: false
          schema: { type: integer, default: 5 }
      responses:
        '200': { description: OK }
  /chunks/{id}:
    get:
      summary: Get a chunk by id
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200': { description: OK }
        '404': { description: Not found }
  /fs/list:
    get:
      summary: List files/directories
      parameters:
        - in: query
          name: subdir
          schema: { type: string }
      responses:
        '200': { description: OK }
  /fs/read:
    get:
      summary: Read a text file
      parameters:
        - in: query
          name: path
          required: true
          schema: { type: string }
      responses:
        '200': { description: OK }
        '415': { description: Unsupported media type }
        '404': { description: Not found }
  /actions/run:
    post:
      summary: Run a whitelisted action
      security:
        - bridgeKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                command: { type: string }
                args: { type: object }
              required: [command, args]
      responses:
        '200': { description: OK }
        '400': { description: Unknown or invalid command }
        '401': { description: Missing or invalid key }
        '412': { description: Precondition failed (e.g., requested AI path disabled) }
  /soul/state:
    get:
      summary: Get Soul state and policies
      responses:
        '200': { description: OK }
  /soul/rituals:
    get:
      summary: List available rituals
      responses:
        '200': { description: OK }
components:
  securitySchemes:
    bridgeKey:
      type: apiKey
      in: header
      name: X-Bridge-Key
