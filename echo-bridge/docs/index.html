<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ECHO-BRIDGE</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 2rem; color: #222; }
    header { display: flex; align-items: baseline; gap: .5rem; }
    h1 { font-size: 1.4rem; margin: 0; }
    .mood { padding: .15rem .5rem; border-radius: .5rem; background: #eef; }
    .row { display: flex; gap: 1rem; margin-top: 1rem; }
    .card { border: 1px solid #ddd; border-radius: .5rem; padding: 1rem; flex: 1; }
    input, button { padding: .5rem; }
    pre { white-space: pre-wrap; background: #fafafa; border: 1px solid #eee; padding: .5rem; }
  </style>
</head>
<body>
  <header>
    <h1>ECHO-BRIDGE</h1>
    <span id="mood" class="mood">…</span>
  </header>

  <div class="row">
    <div class="card">
      <h3>Status</h3>
      <div>Policies: <pre id="policies">loading…</pre></div>
    </div>
    <div class="card">
      <h3>Rituale</h3>
      <ul id="rituals"></ul>
    </div>
  </div>

  <div class="card" style="margin-top:1rem;">
    <h3>Suche</h3>
    <input id="q" placeholder="Freude, Fokus…" />
    <button id="btnSearch">Suchen</button>
    <pre id="results"></pre>
  </div>

  <script>
  async function loadSoul() {
    try {
      const s = await fetch('/soul/state').then(r=>r.json());
      document.getElementById('mood').textContent = s.mood;
      document.getElementById('policies').textContent = JSON.stringify(s.policies, null, 2);
      const r = await fetch('/soul/rituals').then(r=>r.json());
      const ul = document.getElementById('rituals');
      ul.innerHTML='';
      (r.rituals||[]).slice(0,5).forEach(it=>{
        const li = document.createElement('li');
        li.textContent = it.title || JSON.stringify(it);
        ul.appendChild(li);
      });
    } catch(e) { console.warn(e); }
  }
  async function doSearch() {
    const q = document.getElementById('q').value;
    const res = await fetch('/search?q='+encodeURIComponent(q)).then(r=>r.json());
    document.getElementById('results').textContent = JSON.stringify(res.hits || [], null, 2);
  }
  document.getElementById('btnSearch').addEventListener('click', doSearch);
  loadSoul();
  </script>
</body>
</html>
