<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Echo Bridge UI</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 12px; }
      textarea { width: 100%; height: 80px; }
      #events { border: 1px solid #ddd; padding: 8px; height: 220px; overflow:auto; background:#f9f9f9 }
      label { font-weight: bold }
      .row { margin-bottom: 8px }
    </style>
  </head>
  <body>
    <h2>Echo Bridge â€” quick UI</h2>
    <div class="row">
      <label for="apiKey">X-Bridge-Key</label>
      <input id="apiKey" placeholder="SECRET" style="width:40%" />
    </div>
    <div class="row">
      <label for="payload">Generate payload (JSON)</label>
      <textarea id="payload">{"input":"hello world"}</textarea>
    </div>
    <div class="row">
      <button id="send">POST /bridge/link_echo_generate/echo_generate</button>
      <button id="sse">Connect /mcp (SSE)</button>
      <button id="clear">Clear Events</button>
    </div>
    <h3>Response</h3>
    <pre id="response" style="background:#111;color:#bada55;padding:8px"></pre>

    <h3>Events (/mcp)</h3>
    <div id="events"></div>

    <script>
      const sendBtn = document.getElementById('send');
      const sseBtn = document.getElementById('sse');
      const clearBtn = document.getElementById('clear');
      const events = document.getElementById('events');
      const response = document.getElementById('response');
      const apiKeyInput = document.getElementById('apiKey');

      sendBtn.onclick = async () => {
        response.textContent = '...waiting';
        try {
          const payload = JSON.parse(document.getElementById('payload').value);
          const res = await fetch('/bridge/link_echo_generate/echo_generate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'X-Bridge-Key': apiKeyInput.value || '' },
            body: JSON.stringify(payload)
          });
          const txt = await res.text();
          response.textContent = `${res.status} ${res.statusText}\n\n` + txt;
        } catch (e) {
          response.textContent = 'Error: '+e;
        }
      };

      let es;
      sseBtn.onclick = () => {
        if (es) { es.close(); es = null; sseBtn.textContent = 'Connect /mcp (SSE)'; return }
        events.innerHTML = '';
        const url = (location.protocol === 'https:' ? 'https:' : 'http:') + '//' + location.host + '/mcp';
        es = new EventSource(url, { withCredentials: false });
        sseBtn.textContent = 'Disconnect SSE';
        es.onmessage = (ev) => { const d = document.createElement('div'); d.textContent = `[message] ${ev.data}`; events.appendChild(d); events.scrollTop = events.scrollHeight };
        es.onerror = (ev) => { const d = document.createElement('div'); d.textContent = `[error] ${JSON.stringify(ev)}`; events.appendChild(d); events.scrollTop = events.scrollHeight };
        es.addEventListener('open', () => { const d = document.createElement('div'); d.textContent = '[open]'; events.appendChild(d) });
      };

      clearBtn.onclick = () => { events.innerHTML = ''; response.textContent = '' };
    </script>
  </body>
</html>
